charm_name: neutron-openvswitch

smoke_bundles:
  - bionic-train-dvr-snat

gate_bundles:
  - bionic-queens-dvr-snat
  - no-vswitch-restart: bionic-rocky-dvr-snat
  - bionic-stein-dvr-snat
  - bionic-train-dvr-snat

dev_bundles: []

configure:
  - no-vswitch-restart:
    - zaza.openstack.charm_tests.glance.setup.add_lts_image
    - zaza.openstack.charm_tests.neutron.setup.basic_overcloud_network
    - zaza.openstack.charm_tests.nova.setup.create_flavors
    - zaza.openstack.charm_tests.nova.setup.manage_ssh_key
  - zaza.openstack.charm_tests.glance.setup.add_lts_image
  - zaza.openstack.charm_tests.neutron.setup.basic_overcloud_network
  - zaza.openstack.charm_tests.nova.setup.create_flavors
  - zaza.openstack.charm_tests.nova.setup.manage_ssh_key

configure_options:
  configure_gateway_ext_port_use_juju_wait: false

tests:
  - zaza.openstack.charm_tests.neutron.tests.NeutronOVSDeferredRestartTest
  - zaza.openstack.charm_tests.neutron.tests.NeutronNetworkingTest
  - zaza.openstack.charm_tests.neutron.tests.NeutronOpenvSwitchTest
  - zaza.openstack.charm_tests.neutron.tests.NeutronOvsVsctlTest
  - zaza.openstack.charm_tests.neutron.tests.NeutronBridgePortMappingTest
  # Do not include restart tests due to Bug #1990264
  - no-vswitch-restart:
    - zaza.openstack.charm_tests.neutron.tests.NeutronNetworkingTest
    - zaza.openstack.charm_tests.neutron.tests.NeutronOpenvSwitchTest
    - zaza.openstack.charm_tests.neutron.tests.NeutronOvsVsctlTest
    - zaza.openstack.charm_tests.neutron.tests.NeutronBridgePortMappingTest

tests_options:
  # NOTE: This allows us to run the NeutronNetworkingTest multiple times while
  # reusing the instances created for the first run. This both saves time and
  # allows verifying instances survive a SDN migration.
  zaza.openstack.charm_tests.neutron.tests.NeutronNetworkingTest.test_instances_have_networking.run_resource_cleanup: false
  force_deploy: []
